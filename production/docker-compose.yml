version: '3'

services:
    jenkins:
        build: .
        environment:
            JENKINS_USER_PASSWORD: admin
            GIT_REPOSITORY_URL: vincent-andrieu/LabosDiscordBotV2
        ports:
            - "4242:4242"
        networks:
            - docker-registry
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock"
        depends_on:
            - db
            - docker-registry
        restart: always

    db:
        image: mongo:4.4
        command: [ --auth ]
        volumes:
            - mongodb-data:/data/db
        ports:
            - "27017:27017"
        environment:
            MONGO_INITDB_DATABASE: DiscordLaboBotV2
            MONGO_INITDB_ROOT_USERNAME: root
            MONGO_INITDB_ROOT_PASSWORD: root_password
        restart: always

    docker-registry:
        image: registry:2.7.1
        expose:
            - 5000
        networks:
            - docker-registry
        restart: always

networks:
    docker-registry: null

volumes:
    mongodb-data: null
